(function(){if(!!window.JCCatalogSectionComponent){return}window.JCCatalogSectionComponent=function(b){this.formPosting=false;this.siteId=b.siteId||"";this.ajaxId=b.ajaxId||"";this.template=b.template||"";this.componentPath=b.componentPath||"";this.parameters=b.parameters||"";if(b.navParams){this.navParams={NavNum:b.navParams.NavNum||1,NavPageNomer:parseInt(b.navParams.NavPageNomer)||1,NavPageCount:parseInt(b.navParams.NavPageCount)||1}}this.bigData=b.bigData||{enabled:false};this.container=document.querySelector('[data-entity="'+b.container+'"]');this.showMoreButton=null;this.showMoreButtonMessage=null;if(this.bigData.enabled&&BX.util.object_keys(this.bigData.rows).length>0){BX.cookie_prefix=this.bigData.js.cookiePrefix||"";BX.cookie_domain=this.bigData.js.cookieDomain||"";BX.current_server_time=this.bigData.js.serverTime;BX.ready(BX.delegate(this.bigDataLoad,this))}if(b.initiallyShowHeader){BX.ready(BX.delegate(this.showHeader,this))}if(b.deferredLoad){BX.ready(BX.delegate(this.deferredLoad,this))}if(b.lazyLoad){this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]');this.showMoreButtonMessage=this.showMoreButton.innerHTML;BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))}if(b.loadOnScroll){BX.bind(window,"scroll",BX.proxy(this.loadOnScroll,this))}};window.JCCatalogSectionComponent.prototype={checkButton:function(){if(this.showMoreButton){if(this.navParams.NavPageNomer==this.navParams.NavPageCount){BX.remove(this.showMoreButton)}else{this.container.appendChild(this.showMoreButton)}}},enableButton:function(){if(this.showMoreButton){BX.removeClass(this.showMoreButton,"disabled");this.showMoreButton.innerHTML=this.showMoreButtonMessage}},disableButton:function(){if(this.showMoreButton){BX.addClass(this.showMoreButton,"disabled");this.showMoreButton.innerHTML=BX.message("BTN_MESSAGE_LAZY_LOAD_WAITER")}},loadOnScroll:function(){var c=BX.GetWindowScrollPos().scrollTop,d=BX.pos(this.container).bottom;if(c+window.innerHeight>d){this.showMore()}},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var b={};b.action="showMore";b["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1;if(!this.formPosting){this.formPosting=true;this.disableButton();this.sendRequest(b)}}},bigDataLoad:function(){var e="https://analytics.bitrix.info/crecoms/v1_0/recoms.php",d=BX.ajax.prepareData(this.bigData.params);if(d){e+=(e.indexOf("?")!==-1?"&":"?")+d}var f=BX.delegate(function(a){this.sendRequest({action:"deferredLoad",bigData:"Y",items:a&&a.items||[],rid:a&&a.id,count:this.bigData.count,rowsRange:this.bigData.rowsRange,shownIds:this.bigData.shownIds})},this);BX.ajax({method:"GET",dataType:"json",url:e,timeout:3,onsuccess:f,onfailure:f})},deferredLoad:function(){this.sendRequest({action:"deferredLoad"})},sendRequest:function(c){var d={siteId:this.siteId,template:this.template,parameters:this.parameters};if(this.ajaxId){d.AJAX_ID=this.ajaxId}BX.ajax({url:this.componentPath+"/ajax.php"+(document.location.href.indexOf("clear_cache=Y")!==-1?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(d,c),onsuccess:BX.delegate(function(a){if(!a||!a.JS){return}BX.ajax.processScripts(BX.processHTML(a.JS).SCRIPT,false,BX.delegate(function(){this.showAction(a,c)},this))},this)})},showAction:function(d,c){if(!c){return}switch(c.action){case"showMore":this.processShowMoreAction(d);break;case"deferredLoad":this.processDeferredLoadAction(d,c.bigData==="Y");break}},processShowMoreAction:function(b){this.formPosting=false;this.enableButton();if(b){this.navParams.NavPageNomer++;this.processItems(b.items);this.processPagination(b.pagination);this.processEpilogue(b.epilogue);this.checkButton()}},processDeferredLoadAction:function(d,f){if(!d){return}var e=f?this.bigData.rows:{};this.processItems(d.items,BX.util.array_keys(e))},processItems:function(k,i){if(!k){return}var j=BX.processHTML(k,false),m=BX.create("DIV");var n,h,l;m.innerHTML=j.HTML;n=m.querySelectorAll('[data-entity="items-row"]');if(n.length){this.showHeader(true);for(h in n){if(n.hasOwnProperty(h)){l=i?this.container.querySelectorAll('[data-entity="items-row"]'):false;n[h].style.opacity=0;if(l&&BX.type.isDomNode(l[i[h]])){l[i[h]].parentNode.insertBefore(n[h],l[i[h]])}else{this.container.appendChild(n[h])}}}new BX.easing({duration:2000,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){for(var b in n){if(n.hasOwnProperty(b)){n[b].style.opacity=a.opacity/100}}},complete:function(){for(var a in n){if(n.hasOwnProperty(a)){n[a].removeAttribute("style")}}}}).animate()}BX.ajax.processScripts(j.SCRIPT)},processPagination:function(f){if(!f){return}var e=document.querySelectorAll('[data-pagination-num="'+this.navParams.NavNum+'"]');for(var d in e){if(e.hasOwnProperty(d)){e[d].innerHTML=f}}},processEpilogue:function(d){if(!d){return}var c=BX.processHTML(d,false);BX.ajax.processScripts(c.SCRIPT)},showHeader:function(d){var e=BX.findParent(this.container,{attr:{"data-entity":"parent-container"}}),f;if(e&&BX.type.isDomNode(e)){f=e.querySelector('[data-entity="header"]');if(f&&f.getAttribute("data-showed")!="true"){f.style.display="";if(d){new BX.easing({duration:2000,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){f.style.opacity=a.opacity/100},complete:function(){f.removeAttribute("style");f.setAttribute("data-showed","true")}}).animate()}else{f.style.opacity=100}}}}}})();